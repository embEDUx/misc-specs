#! /bin/bash -e

#####################
# Configuration     # 							     
#####################

### Sources
SRC_DIR="src"
SRC_SCR="boot.scr.txt"

### Outputs
DST_IMG="misc.tar.gz"
DST_SCR="boot.scr"
DST_DIR="output"
DST_PRE="$(date '+%Y%m%d')_$(date '+%H-%M-%S')"

#####################
# Script            #
#####################
mkdir ${DST_DIR}

### Make boot.scr
mkimage -A arm -O linux -T script -C none -n ${DST_SCR} -d ${SRC_DIR}/${SRC_SCR} \
	${SRC_DIR}/${DST_SCR}

### Pack files into archive
if [ "$(ls | grep -v build)" ]
  then
        tar --exclude=${SRC_SCR} -czf ${DST_DIR}/${DST_PRE}_${DST_IMG} -C ${SRC_DIR} .
fi

### Clean up
rm ${SRC_DIR}/${DST_SCR}

