#! /bin/bash -e

#####################
# Configuration     # 							     
#####################

### Sources
SRC_SCR="boot.scr.txt"

### Outputs
DST_IMG="misc.tar.gz"
DST_SCR="boot.scr"
DST_DIR="output"
DST_PRE="$(date '+%Y%m%d')_$(date '+%H-%M-%S')_3.17.5"

#####################
# Script            #
#####################

### Make boot.scr
mkimage -A arm -O linux -T script -C none -n ${DST_SCR} -d ${SRC_SCR}  ${DST_SCR}

mkdir ${DST_DIR}

### Pack files into archive
if [ "$(ls | grep -v build)" ]
	then
        tar --exclude build,.git,${DST_IMG} -czf ${DST_DIR}/${DST_PRE}_${DST_IMG} *
fi

### Clean up
rm ${DST_SCR}

